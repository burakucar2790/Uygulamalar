<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bahar Piano - Mobile & Touch</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none; /* Kaydırmayı engeller */
        }
        #canvas-container {
            width: 100%;
            max-width: 1050px;
            aspect-ratio: 1050 / 445;
            position: relative;
        }
        canvas {
            width: 100%;
            height: 100%;
            display: block;
            background-color: #333;
        }
        /* Başlatma Ekranı (Tarayıcı ses engeli için) */
        #overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            font-family: sans-serif;
            text-align: center;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div id="overlay">
    <div>
        <h1>BAHAR PIANO</h1>
        <p>Başlamak için dokunun veya bir tuşa basın</p>
    </div>
</div>

<div id="canvas-container">
    <canvas id="pianoCanvas" width="1050" height="445"></canvas>
</div>

<script>
const canvas = document.getElementById('pianoCanvas');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');
const yesil = "rgb(0, 128, 0)";

// Görseller
const arkaPlan = new Image();
arkaPlan.src = 'resimler/arkaplan1.png';

// Sesler ve Koordinat Verisi
const tuslar = {
    'a': { s: 'notalar/C4.wav', x: 70, y: 400 },
    's': { s: 'notalar/D4.wav', x: 160, y: 400 },
    'd': { s: 'notalar/E4.wav', x: 250, y: 400 },
    'f': { s: 'notalar/F4.wav', x: 340, y: 400 },
    'g': { s: 'notalar/G4.wav', x: 440, y: 400 },
    'h': { s: 'notalar/A4.wav', x: 530, y: 400 },
    'j': { s: 'notalar/B4.wav', x: 620, y: 400 },
    'k': { s: 'notalar/C5.wav', x: 720, y: 400 },
    'l': { s: 'notalar/D5.wav', x: 800, y: 400 },
    'z': { s: 'notalar/E5.wav', x: 900, y: 400 },
    'x': { s: 'notalar/F5.wav', x: 990, y: 400 },
    // Siyahlar
    'q': { s: 'notalar/C4sharp.wav', x: 115, y: 290 },
    'w': { s: 'notalar/D4sharp.wav', x: 205, y: 290 },
    'e': { s: 'notalar/F4sharp.wav', x: 387, y: 290 },
    'r': { s: 'notalar/G4sharp.wav', x: 485, y: 290 },
    't': { s: 'notalar/A4sharp.wav', x: 575, y: 290 },
    'y': { s: 'notalar/C5sharp.wav', x: 760, y: 290 },
    'u': { s: 'notalar/D5sharp.wav', x: 855, y: 290 }
};

// Sesleri önceden yükle
const audioElements = {};
Object.keys(tuslar).forEach(key => {
    audioElements[key] = new Audio(tuslar[key].s);
});

let aktifTuslar = new Set();

// Sesi Oynat
function sesiCal(key) {
    if (audioElements[key]) {
        const sound = audioElements[key];
        sound.currentTime = 0;
        sound.play().catch(() => {}); // Ses engeline takılmasın
        aktifTuslar.add(key);
    }
}

// Giriş kilidini aç
overlay.addEventListener('click', () => {
    overlay.style.display = 'none';
    // iOS için sessiz ses oynatma gerekebilir
});

// Klavye Olayları
window.addEventListener('keydown', (e) => {
    const key = e.key.toLowerCase();
    if (tuslar[key] && !aktifTuslar.has(key)) {
        sesiCal(key);
    }
});
window.addEventListener('keyup', (e) => {
    aktifTuslar.delete(e.key.toLowerCase());
});

// Dokunmatik ve Mouse Olayları (Ölçekleme Dahil)
function etkilesimKontrol(clientX, clientY) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = 1050 / rect.width;
    const scaleY = 445 / rect.height;
    const x = (clientX - rect.left) * scaleX;
    const y = (clientY - rect.top) * scaleY;

    // Hangi tuşa yakın olduğunu kontrol et (Tolerans: 40px)
    Object.keys(tuslar).forEach(key => {
        const t = tuslar[key];
        const dist = Math.sqrt((x - t.x) ** 2 + (y - t.y) ** 2);
        if (dist < 45) {
            sesiCal(key);
            setTimeout(() => aktifTuslar.delete(key), 200); // Görsel efekt için
        }
    });
}

canvas.addEventListener('mousedown', (e) => etkilesimKontrol(e.clientX, e.clientY));
canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const touch = e.touches[0];
    etkilesimKontrol(touch.clientX, touch.clientY);
}, {passive: false});

// Çizim Döngüsü
function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (arkaPlan.complete) {
        ctx.drawImage(arkaPlan, 0, 0, 1050, 445);
    }

    aktifTuslar.forEach(key => {
        const t = tuslar[key];
        ctx.beginPath();
        ctx.arc(t.x, t.y, 15, 0, Math.PI * 2);
        ctx.fillStyle = yesil;
        ctx.fill();
        ctx.closePath();
    });

    requestAnimationFrame(render);
}
render();
</script>
</body>

</html>
