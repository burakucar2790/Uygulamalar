<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Turing File Explorer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-desktop: #cbd5e1;
            --bg-window: #ffffff;
            --bg-sidebar: #f8fafc;
            --bg-header: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --primary: #0ea5e9;
            --primary-hover: #0284c7;
            --border-color: #e2e8f0;
            --hover-bg: #f1f5f9;
            --selected-bg: #e0f2fe;
            --selected-border: #bae6fd;
            --icon-size: 64px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --shadow-window: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; user-select: none; margin: 0; padding: 0; }

        body { 
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%); 
            height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 40px; 
            color: var(--text-main); 
            overflow: hidden;
        }

        .window { 
            background: var(--bg-window); 
            border-radius: var(--radius-lg); 
            box-shadow: var(--shadow-window); 
            width: 90vw; 
            max-width: 1200px; 
            height: 85vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.4); 
        }

        .top-section { border-bottom: 1px solid var(--border-color); background: var(--bg-header); }
        
        .title-bar { 
            padding: 10px 16px; 
            font-weight: 600; 
            font-size: 14px; 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            color: var(--text-main); 
            -webkit-app-region: drag; 
        }
        .title-bar svg { color: var(--primary); }

        .menu-bar { display: flex; gap: 4px; padding: 0 12px 6px; position: relative; z-index: 100; }
        .dropdown { position: relative; }
        .drop-btn { padding: 6px 12px; cursor: pointer; border: none; background: transparent; font-size: 13px; font-weight: 500; border-radius: 6px; color: var(--text-main); transition: background 0.2s; }
        .drop-btn:hover, .drop-btn.active { background: var(--hover-bg); }
        .drop-content { display: none; position: absolute; background: white; min-width: 220px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); border: 1px solid var(--border-color); top: 100%; left: 0; border-radius: 8px; padding: 6px; z-index: 1000; }
        .dropdown.active .drop-content { display: block; animation: fadeIn 0.15s ease-out; }
        .drop-item { padding: 8px 12px; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 10px; border-radius: 4px; color: var(--text-main); transition: 0.1s; }
        .drop-item:hover { background: var(--primary); color: white; }
        .ctx-divider { height: 1px; background: var(--border-color); margin: 4px 0; }

        .toolbar { padding: 10px 16px; border-bottom: 1px solid var(--border-color); display: flex; gap: 12px; align-items: center; background: var(--bg-window); }
        .nav-group { display: flex; gap: 4px; }
        .nav-btn { display: flex; justify-content: center; align-items: center; width: 32px; height: 32px; border: none; cursor: pointer; background: transparent; font-size: 16px; border-radius: 6px; color: var(--text-main); transition: 0.2s; }
        .nav-btn:hover:not(:disabled) { background: var(--hover-bg); }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .address-bar { display: flex; align-items: center; flex: 1; min-width: 150px; background: var(--bg-sidebar); border: 1px solid transparent; padding: 0 12px; border-radius: 6px; height: 32px; transition: border 0.2s; }
        .address-bar:focus-within { border-color: var(--primary); background: white; }
        .address-input { flex: 1; padding: 0 8px; border: none; font-size: 13px; outline: none; background: transparent; color: var(--text-main); }

        .view-select { font-size: 13px; padding: 0 10px; height: 32px; border: 1px solid var(--border-color); border-radius: 6px; outline: none; background: var(--bg-sidebar); cursor: pointer; }

        .search-box { display: none; align-items: center; background: var(--bg-sidebar); border: 1px solid transparent; padding: 0 10px; border-radius: 6px; width: 220px; height: 32px; transition: 0.2s; }
        .search-box:focus-within { border-color: var(--primary); background: white; }
        .search-input { width: 100%; padding: 0 8px; border: none; font-size: 13px; outline: none; background: transparent; }

        .main-area { display: flex; flex: 1; overflow: hidden; background: var(--bg-window); position: relative; z-index: 10; }
        
        .sidebar { width: 240px; background: var(--bg-sidebar); border-right: 1px solid var(--border-color); overflow-y: auto; padding: 12px 8px; flex-shrink: 0; }
        .tree-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; cursor: pointer; font-size: 13px; font-weight: 500; color: var(--text-main); border-radius: 6px; transition: 0.1s; margin-bottom: 2px; }
        .tree-item:hover { background: var(--hover-bg); }
        .tree-item.active { background: var(--selected-bg); color: var(--primary-hover); }
        .tree-children { margin-left: 20px; border-left: 1px solid var(--border-color); padding-left: 4px; }

        .content-area { 
            flex: 1; 
            padding: 20px; 
            overflow-y: auto; 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            gap: 20px; 
            align-content: flex-start; 
        }
        
        .icon-item { position: relative; display: flex; flex-direction: column; align-items: center; text-align: center; padding: 12px 8px; border: 1px solid transparent; cursor: pointer; border-radius: var(--radius-md); transition: 0.1s; }
        .icon-item:hover { background: var(--hover-bg); }
        .icon-item.selected { background: var(--selected-bg); border-color: var(--selected-border); }
        
        .item-checkbox { position: absolute; top: 6px; left: 6px; width: 16px; height: 16px; cursor: pointer; display: none; z-index: 10; accent-color: var(--primary); }
        .show-checkboxes .item-checkbox, .icon-item:hover .item-checkbox, .icon-item.selected .item-checkbox { display: block; }

        .folder-icon { width: var(--icon-size); height: var(--icon-size); fill: #fcd34d; filter: drop-shadow(0 2px 4px rgba(252,211,77,0.2)); }
        .file-img { width: var(--icon-size); height: var(--icon-size); object-fit: cover; border-radius: 8px; border: 1px solid var(--border-color); background: #eee; }
        .note-icon { width: var(--icon-size); height: var(--icon-size); fill: #ffffff; stroke: #94a3b8; stroke-width: 2; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.05)); }
        
        .item-label { margin-top: 8px; font-size: 12px; font-weight: 500; line-height: 1.3; word-break: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: var(--text-main); }
        .item-label-sub { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

        .status-bar { background: var(--bg-window); border-top: 1px solid var(--border-color); padding: 8px 16px; font-size: 12px; color: var(--text-muted); display: flex; justify-content: space-between; }

        .dialog-overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(2px); z-index: 2000; justify-content: center; align-items: center; opacity: 0; animation: fadeIn 0.2s forwards; }
        .dialog { background: var(--bg-window); border-radius: var(--radius-lg); box-shadow: var(--shadow-window); width: 90%; max-width: 450px; display: flex; flex-direction: column; max-height: 85vh; transform: scale(0.95); animation: popIn 0.2s forwards; }
        
        .dialog-header { padding: 16px 20px; font-weight: 600; font-size: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
        .dialog-header span:last-child { cursor: pointer; color: var(--text-muted); font-size: 16px; padding: 4px; border-radius: 4px; transition: 0.1s; }
        .dialog-header span:last-child:hover { background: #fee2e2; color: #ef4444; }
        
        .dialog-body { padding: 20px; font-size: 13px; display: flex; flex-direction: column; gap: 14px; overflow-y: auto; }
        .dialog-body label { font-weight: 600; color: var(--text-main); margin-bottom: -6px; }
        
        .dialog-footer { padding: 14px 20px; text-align: right; border-top: 1px solid var(--border-color); background: var(--bg-sidebar); border-radius: 0 0 var(--radius-lg) var(--radius-lg); display: flex; justify-content: flex-end; gap: 8px; }
        
        input[type="text"], select, textarea { width: 100%; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 13px; outline: none; transition: 0.2s; background: var(--bg-window); }
        input[type="text"]:focus, textarea:focus, .rich-editor:focus { border-color: var(--primary); }
        
        .rich-editor { width: 100%; min-height: 150px; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; font-size: 13px; outline: none; overflow-y: auto; background: white; line-height: 1.5; }
        
        .editor-toolbar { display: flex; gap: 4px; margin-bottom: 8px; background: var(--bg-sidebar); padding: 6px; border-radius: 6px; border: 1px solid var(--border-color); }
        .editor-btn { padding: 6px 10px; font-size: 12px; cursor: pointer; border: none; background: transparent; border-radius: 4px; font-weight: 600; color: var(--text-main); transition: 0.1s; }
        .editor-btn:hover { background: var(--border-color); }

        .dialog-btn { padding: 8px 16px; border: 1px solid var(--border-color); background: white; cursor: pointer; font-size: 13px; font-weight: 500; border-radius: 6px; color: var(--text-main); transition: 0.1s; }
        .dialog-btn.primary { background: var(--primary); color: white; border-color: var(--primary); }
        .dialog-btn:hover { background: var(--hover-bg); }
        .dialog-btn.primary:hover { background: var(--primary-hover); }

        .input-group { display: flex; gap: 6px; align-items: center; }
        .smart-btn { padding: 8px 12px; font-size: 12px; font-weight: 500; cursor: pointer; border: 1px solid var(--border-color); background: white; border-radius: 6px; white-space: nowrap; transition: 0.1s; }
        .smart-btn:hover { background: var(--hover-bg); }
        
        .play-btn { background: #10b981; color: white; border: none; border-radius: 6px; width: 34px; height: 34px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: 0.1s; }
        .play-btn:hover { background: #059669; }

        #contextMenu { display: none; position: absolute; background: white; border: 1px solid var(--border-color); box-shadow: 0 10px 20px rgba(0,0,0,0.15); z-index: 3000; width: 200px; border-radius: 8px; padding: 6px; animation: fadeIn 0.1s; }
        .ctx-item { padding: 8px 12px; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 10px; border-radius: 4px; color: var(--text-main); }
        .ctx-item:hover { background: var(--primary); color: white; }

        .details-grid { display: grid; grid-template-columns: 90px 1fr; gap: 8px; margin-bottom: 8px; align-items: center; }
        .details-label { font-weight: 600; color: var(--text-muted); font-size: 12px; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        @media (max-width: 768px) {
            body { padding: 0; background: var(--bg-window); }
            .window { border-radius: 0; border: none; width: 100vw; height: 100vh; max-width: none; }
            .sidebar { display: none; }
            .toolbar { flex-wrap: wrap; }
            .search-box { width: 100%; order: 3; margin-top: 8px; }
            .content-area { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); padding: 10px; gap: 10px; }
        }
    </style>
</head>
<body onclick="closeAllMenus()">

<div class="window">
    <div class="top-section" id="uiTitleBar">
        <div class="title-bar">
            <svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='currentColor'><path d='M2 4h20v16H2z'/></svg>
            Turing Explorer
        </div>
        
        <div class="menu-bar" id="uiMenuBar">
            <div class="dropdown" id="menuDosya" onclick="toggleMenu('menuDosya', event)">
                <button class="drop-btn">Dosya</button>
                <div class="drop-content">
                    <div class="drop-item" onclick="createItem('folder')">üìÅ Yeni Klas√∂r</div>
                    <div class="drop-item" onclick="createItem('word')">üìÑ Yeni Kelime Kartƒ±</div>
                    <div class="drop-item" onclick="openBulkModal()">üóÇÔ∏è Toplu Kelime Ekle</div>
                    <div class="ctx-divider"></div>
                    <div class="drop-item" onclick="createItem('note')">üìù Yeni Not Defteri</div>
                </div>
            </div>
            
            <div class="dropdown" id="menuDuzenle" onclick="toggleMenu('menuDuzenle', event)">
                <button class="drop-btn">D√ºzenle</button>
                <div class="drop-content">
                    <div class="drop-item" onclick="selectAll()">‚úÖ T√ºm√ºn√º Se√ß</div>
                    <div class="drop-item" onclick="focusSearch()">üîç Bul</div>
                    <div class="ctx-divider"></div>
                    <div class="drop-item" onclick="ctxAction('copy')">üìã Kopyala</div>
                    <div class="drop-item" onclick="ctxAction('paste')" id="topMenuPaste" style="display:none;">üìã Yapƒ±≈ütƒ±r</div>
                    <div class="ctx-divider"></div>
                    <div class="drop-item" onclick="moveSelected()">‚úÇÔ∏è Se√ßilenleri Ta≈üƒ±</div>
                    <div class="drop-item" onclick="deleteSelected()">üóëÔ∏è Se√ßilenleri Sil</div>
                    <div class="ctx-divider"></div>
                    <div class="drop-item" onclick="toggleUI()">üëÅÔ∏è Gezgini Gizle/G√∂ster</div>
                </div>
            </div>

            <div class="dropdown" id="menuYedek" onclick="toggleMenu('menuYedek', event)">
                <button class="drop-btn">Yedekleme</button>
                <div class="drop-content">
                    <div class="drop-item" onclick="exportData()">‚¨áÔ∏è Yedek ƒ∞ndir</div>
                    <div class="drop-item" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Yedek Y√ºkle</div>
                </div>
            </div>
            <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
        </div>
    </div>

    <div class="toolbar" id="uiToolBar">
        <div class="nav-group">
            <button class="nav-btn" id="btnBack" onclick="goBack()" title="Geri">‚Üê</button>
            <button class="nav-btn" id="btnForward" onclick="goForward()" title="ƒ∞leri">‚Üí</button>
            <button class="nav-btn" onclick="goUp()" title="Yukarƒ±">‚Üë</button>
        </div>
        <div class="address-bar">
            ‚≠ê <input type="text" class="address-input" id="addressPath" readonly>
        </div>
        
        <div style="display: flex; gap: 8px; align-items: center;">
            <select class="view-select" id="viewMode" onchange="renderContent()" title="G√∂r√ºn√ºm Modu">
                <option value="all">T√ºm√º (TR/EN)</option>
                <option value="tr">Sadece TR</option>
                <option value="en">Sadece EN</option>
            </select>

            <select class="view-select" id="sortMode" onchange="renderContent()" title="Sƒ±ralama Modu">
                <option value="name_asc">A - Z</option>
                <option value="name_desc">Z - A</option>
                <option value="date_desc">En Yeni</option>
                <option value="date_asc">En Eski</option>
            </select>
        </div>

        <div class="search-box" id="uiSearchBox">
            üîç <input type="text" id="searchBox" class="search-input" placeholder="Genel Arama yap..." oninput="renderContent()">
        </div>
    </div>

    <div class="main-area">
        <div class="sidebar" id="sidebarTree"></div>
        <div class="content-area" id="contentArea" onclick="clearSelection()" oncontextmenu="showContextMenu(event, 'bg', null)"></div>
    </div>

    <div class="status-bar" id="uiStatusBar">
        <span id="statusText">0 √∂ƒüe | 0 se√ßili</span>
    </div>
</div>

<div id="contextMenu">
    <div id="ctxNewGroup">
        <div class="ctx-item" onclick="createItem('folder')">üìÅ Yeni Klas√∂r</div>
        <div class="ctx-item" onclick="createItem('word')">üìÑ Yeni Kelime</div>
        <div class="ctx-item" onclick="openBulkModal()">üóÇÔ∏è Toplu Ekle</div>
        <div class="ctx-item" onclick="createItem('note')">üìù Yeni Not</div>
        <div class="ctx-divider"></div>
    </div>
    <div class="ctx-item" id="ctxOpen" onclick="ctxAction('open')">üìÇ A√ß</div>
    <div class="ctx-item" id="ctxCopy" onclick="ctxAction('copy')">üìã Kopyala</div>
    <div class="ctx-item" id="ctxPaste" onclick="ctxAction('paste')">üìã Yapƒ±≈ütƒ±r</div>
    <div class="ctx-item" id="ctxEdit" onclick="ctxAction('edit')">‚öôÔ∏è √ñzellikler</div>
    <div class="ctx-item" id="ctxDetails" onclick="ctxAction('details')">‚ÑπÔ∏è Detaylar</div>
    <div class="ctx-item" id="ctxMove" onclick="ctxAction('move')">‚úÇÔ∏è Ta≈üƒ±...</div>
    <div class="ctx-divider" id="ctxDiv2"></div>
    <div class="ctx-item" id="ctxDelete" onclick="ctxAction('delete')">üóëÔ∏è Sil</div>
</div>

<div class="dialog-overlay" id="detailsDialog">
    <div class="dialog">
        <div class="dialog-header"><span>√ñƒüe Detaylarƒ±</span> <span onclick="closeDialog('detailsDialog')">‚úñ</span></div>
        <div class="dialog-body" id="detailsBody"></div>
        <div class="dialog-footer">
            <button class="dialog-btn" onclick="closeDialog('detailsDialog')">Kapat</button>
        </div>
    </div>
</div>

<div class="dialog-overlay" id="bulkDialog">
    <div class="dialog">
        <div class="dialog-header"><span>Toplu Kelime Ekle</span> <span onclick="closeDialog('bulkDialog')">‚úñ</span></div>
        <div class="dialog-body">
            <label>Eklenecek Kelimeler:</label>
            <textarea id="bulkInput" rows="6" placeholder="apple&#10;banana&#10;car..."></textarea>
            <label>√áeviri Y√∂n√º:</label>
            <select id="bulkLang">
                <option value="en|tr">ƒ∞ngilizce -> T√ºrk√ße</option>
                <option value="tr|en">T√ºrk√ße -> ƒ∞ngilizce</option>
            </select>
            <div id="bulkStatus" style="color:var(--primary); font-weight:600; font-size:12px;"></div>
        </div>
        <div class="dialog-footer">
            <button class="dialog-btn primary" id="bulkStartBtn" onclick="startBulkImport()">Ba≈ülat</button>
            <button class="dialog-btn" onclick="closeDialog('bulkDialog')">ƒ∞ptal</button>
        </div>
    </div>
</div>

<div class="dialog-overlay" id="wordDialog">
    <div class="dialog">
        <div class="dialog-header"><span id="wTitle">Kelime √ñzellikleri</span> <span onclick="closeDialog('wordDialog')">‚úñ</span></div>
        <div class="dialog-body">
            <div style="width:100%; height:120px; border:1px solid var(--border-color); background:var(--bg-sidebar); border-radius: 8px; display:flex; justify-content:center; overflow:hidden;">
                <img id="wPreview" src="" alt="G√∂rsel Yok" style="max-height:100%; object-fit: cover;">
            </div>
            <input type="hidden" id="wId">
            <label>ƒ∞ngilizce:</label>
            <div class="input-group">
                <input type="text" id="wEn" oninput="autoFetchImage()">
                <button class="play-btn" onclick="speakText(document.getElementById('wEn').value, 'en-US')">üîä</button>
                <button class="smart-btn" onclick="translateOS('en')">√áevir</button>
            </div>
            <label>T√ºrk√ße:</label>
            <div class="input-group">
                <input type="text" id="wTr">
                <button class="play-btn" onclick="speakText(document.getElementById('wTr').value, 'tr-TR')">üîä</button>
                <button class="smart-btn" onclick="translateOS('tr')">√áevir</button>
            </div>
            <label>G√∂rsel URL:</label>
            <div class="input-group">
                <input type="text" id="wImg" oninput="updatePrev(this.value)">
                <button class="smart-btn" onclick="randomOSImage()">Rastgele</button>
                <button class="smart-btn" onclick="searchGoogleImage()">Web'de Bul</button>
            </div>
            <div id="wLoader" style="color:var(--primary); display:none; font-size:12px;">ƒ∞≈üleniyor...</div>
        </div>
        <div class="dialog-footer">
            <button class="dialog-btn primary" onclick="saveWord()">Kaydet</button>
            <button class="dialog-btn" onclick="closeDialog('wordDialog')">ƒ∞ptal</button>
        </div>
    </div>
</div>

<div class="dialog-overlay" id="noteDialog">
    <div class="dialog" style="max-width: 550px;">
        <div class="dialog-header"><span id="nTitle">Not Defteri</span> <span onclick="closeDialog('noteDialog')">‚úñ</span></div>
        <div class="dialog-body">
            <input type="hidden" id="nId">
            <div class="input-group">
                <input type="text" id="nTitleInp" placeholder="Not Ba≈ülƒ±ƒüƒ±...">
                <button class="play-btn" onclick="speakText(document.getElementById('nTitleInp').value, 'tr-TR')">üîä</button>
            </div>
            <div class="editor-toolbar">
                <button class="editor-btn" onclick="execCmd('bold')"><b>B</b></button>
                <button class="editor-btn" onclick="execCmd('italic')"><i>I</i></button>
                <button class="editor-btn" onclick="execCmd('underline')"><u>U</u></button>
                <button class="editor-btn" onclick="execCmd('insertUnorderedList')">‚Ä¢ Liste</button>
                <div style="flex:1;"></div>
                <button class="smart-btn" onclick="speakHtmlContent('nContent', 'tr-TR')">üîä Oku</button>
            </div>
            <div id="nContent" class="rich-editor" contenteditable="true" placeholder="Yazmaya ba≈üla..."></div>
        </div>
        <div class="dialog-footer">
            <button class="dialog-btn primary" onclick="saveNote()">Kaydet</button>
            <button class="dialog-btn" onclick="closeDialog('noteDialog')">ƒ∞ptal</button>
        </div>
    </div>
</div>

<div class="dialog-overlay" id="moveDialog">
    <div class="dialog">
        <div class="dialog-header"><span>Hedef Klas√∂r</span> <span onclick="closeDialog('moveDialog')">‚úñ</span></div>
        <div class="dialog-body">
            <select id="moveTargetSelect" size="8" style="height: 180px; padding: 4px;"></select>
        </div>
        <div class="dialog-footer">
            <button class="dialog-btn primary" onclick="executeMove()">Ta≈üƒ±</button>
            <button class="dialog-btn" onclick="closeDialog('moveDialog')">ƒ∞ptal</button>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('turing_v14'));
    if (!db) { db = { folders: [{id: 1, name: 'Turing Belgeleri', parentId: null}], words: [], notes: [] }; }
    if(!db.notes) db.notes = [];
    
    let currentPath = null; let historyStack = [null]; let historyIndex = 0;
    let selectedItems = new Set(); let ctxTarget = null; let clipboard = { items: new Set() };
    let uiIsHidden = false;

    const svgFolder = `<svg class="folder-icon" viewBox="0 0 100 100"><path d="M10 25 Q 10 15 20 15 L 40 15 Q 45 15 50 20 L 60 30 L 85 30 Q 95 30 95 40 L 95 85 Q 95 95 85 95 L 15 95 Q 5 95 5 85 Z"/></svg>`;
    const svgTreeFolder = `<svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="#64748b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>`;
    const svgNote = `<svg class="note-icon" viewBox="0 0 100 100"><rect x="20" y="10" width="60" height="80" rx="6" fill="#fff" stroke="#94a3b8" stroke-width="4"/><line x1="35" y1="35" x2="65" y2="35" stroke="#cbd5e1" stroke-width="4" stroke-linecap="round"/><line x1="35" y1="50" x2="65" y2="50" stroke="#cbd5e1" stroke-width="4" stroke-linecap="round"/><line x1="35" y1="65" x2="50" y2="65" stroke="#cbd5e1" stroke-width="4" stroke-linecap="round"/></svg>`;

    function saveDB() { localStorage.setItem('turing_v14', JSON.stringify(db)); renderAll(); }
    function speakText(text, lang) { if (!text) return; window.speechSynthesis.cancel(); const utterance = new SpeechSynthesisUtterance(text); utterance.lang = lang; utterance.rate = 0.9; window.speechSynthesis.speak(utterance); }
    function speakHtmlContent(elementId, lang) { const el = document.getElementById(elementId); if(!el) return; speakText(el.innerText || el.textContent, lang); }
    function execCmd(command) { document.execCommand(command, false, null); document.getElementById('nContent').focus(); }
    function searchGoogleImage() { const word = document.getElementById('wEn').value.trim(); if(!word) { alert("√ñnce ƒ∞ngilizce kelimeyi girin."); return; } window.open("https://www.google.com/search?tbm=isch&q=" + encodeURIComponent(word), '_blank'); }

    function navigateTo(folderId, recordHistory = true) {
        currentPath = folderId;
        if(recordHistory) { historyStack = historyStack.slice(0, historyIndex + 1); if(historyStack[historyStack.length-1] !== folderId) { historyStack.push(folderId); historyIndex++; } }
        selectedItems.clear(); document.getElementById('searchBox').value = ''; document.getElementById('contentArea').classList.remove('show-checkboxes');
        renderAll(); updateNavButtons();
    }
    
    function goBack() { if(historyIndex > 0) { historyIndex--; navigateTo(historyStack[historyIndex], false); } }
    function goForward() { if(historyIndex < historyStack.length - 1) { historyIndex++; navigateTo(historyStack[historyIndex], false); } }
    function goUp() { if (currentPath !== null) { const f = db.folders.find(x => x.id === currentPath); navigateTo(f ? f.parentId : null); } }
    function updateNavButtons() { document.getElementById('btnBack').disabled = historyIndex === 0; document.getElementById('btnForward').disabled = historyIndex === historyStack.length - 1; }

    function toggleSelect(type, id, e) { e.stopPropagation(); const key = `${type}-${id}`; if(e.ctrlKey || e.shiftKey) { if(selectedItems.has(key)) selectedItems.delete(key); else selectedItems.add(key); } else { selectedItems.clear(); selectedItems.add(key); } renderContent(); }
    function chkClick(e, type, id) { e.stopPropagation(); const key = `${type}-${id}`; if(e.target.checked) selectedItems.add(key); else selectedItems.delete(key); renderContent(); }
    function clearSelection() { selectedItems.clear(); document.getElementById('contentArea').classList.remove('show-checkboxes'); renderContent(); }
    
    function selectAll() {
        closeAllMenus(); // Men√º kapansƒ±n
        selectedItems.clear(); const search = document.getElementById('searchBox').value.toLowerCase();
        
        let fList = search ? db.folders.filter(f => f.name.toLowerCase().includes(search)) : db.folders.filter(f => f.parentId === currentPath);
        let wList = search ? db.words.filter(w => (w.en.toLowerCase().includes(search) || w.tr.toLowerCase().includes(search))) : db.words.filter(w => w.fid === currentPath);
        let nList = search ? db.notes.filter(n => n.title.toLowerCase().includes(search)) : db.notes.filter(n => n.fid === currentPath);
        
        fList.forEach(f => selectedItems.add(`folder-${f.id}`));
        wList.forEach(w => selectedItems.add(`word-${w.id}`));
        nList.forEach(n => selectedItems.add(`note-${n.id}`));
        
        document.getElementById('contentArea').classList.add('show-checkboxes'); renderContent();
    }

    function buildTreeHTML(parentId) {
        let html = ''; const children = db.folders.filter(f => f.parentId === parentId); if (children.length === 0) return '';
        html += `<div class="tree-children">`;
        children.forEach(f => { html += `<div class="tree-item ${currentPath === f.id ? 'active' : ''}" onclick="navigateTo(${f.id}); event.stopPropagation();">${svgTreeFolder} <span>${f.name}</span></div>${buildTreeHTML(f.id)}`; });
        html += `</div>`; return html;
    }

    function renderSidebar() { document.getElementById('sidebarTree').innerHTML = `<div class="tree-item ${currentPath === null ? 'active' : ''}" onclick="navigateTo(null)">${svgTreeFolder} <span>Gezgin</span></div>${buildTreeHTML(null)}`; }

    function getSortedArray(arr, nameKey) {
        const mode = document.getElementById('sortMode').value;
        return arr.sort((a, b) => {
            if (mode === 'name_asc') return a[nameKey].localeCompare(b[nameKey]);
            if (mode === 'name_desc') return b[nameKey].localeCompare(a[nameKey]);
            if (mode === 'date_desc') return b.id - a.id;
            if (mode === 'date_asc') return a.id - b.id;
            return 0;
        });
    }

    function renderContent() {
        const area = document.getElementById('contentArea'); const search = document.getElementById('searchBox').value.toLowerCase(); const viewMode = document.getElementById('viewMode').value;
        area.innerHTML = ''; let count = 0;

        let filteredFolders = search ? db.folders.filter(f => f.name.toLowerCase().includes(search)) : db.folders.filter(f => f.parentId === currentPath);
        let filteredNotes = search ? db.notes.filter(n => n.title.toLowerCase().includes(search)) : db.notes.filter(n => n.fid === currentPath);
        let filteredWords = search ? db.words.filter(w => (w.en.toLowerCase().includes(search) || w.tr.toLowerCase().includes(search))) : db.words.filter(w => w.fid === currentPath);

        filteredFolders = getSortedArray(filteredFolders, 'name'); filteredNotes = getSortedArray(filteredNotes, 'title'); filteredWords = getSortedArray(filteredWords, 'en');

        filteredFolders.forEach(f => {
            const isSel = selectedItems.has(`folder-${f.id}`) ? 'selected' : ''; const isChecked = isSel ? 'checked' : '';
            const div = document.createElement('div'); div.className = `icon-item ${isSel}`;
            div.innerHTML = `<input type="checkbox" class="item-checkbox" ${isChecked} onclick="chkClick(event, 'folder', ${f.id})">${svgFolder}<div class="item-label">${f.name}</div>`;
            div.onclick = (e) => toggleSelect('folder', f.id, e); div.ondblclick = () => navigateTo(f.id); div.oncontextmenu = (e) => showContextMenu(e, 'folder', f.id);
            area.appendChild(div); count++;
        });

        filteredNotes.forEach(n => {
            const isSel = selectedItems.has(`note-${n.id}`) ? 'selected' : ''; const isChecked = isSel ? 'checked' : '';
            const div = document.createElement('div'); div.className = `icon-item ${isSel}`;
            div.innerHTML = `<input type="checkbox" class="item-checkbox" ${isChecked} onclick="chkClick(event, 'note', ${n.id})">${svgNote}<div class="item-label">${n.title}</div>`;
            div.onclick = (e) => toggleSelect('note', n.id, e); div.ondblclick = () => openNoteModal(n.id); div.oncontextmenu = (e) => showContextMenu(e, 'note', n.id);
            area.appendChild(div); count++;
        });

        filteredWords.forEach(w => {
            const isSel = selectedItems.has(`word-${w.id}`) ? 'selected' : ''; const isChecked = isSel ? 'checked' : '';
            const div = document.createElement('div'); div.className = `icon-item ${isSel}`;
            const cleanKey = w.en.split('/')[0].split(',')[0].trim().toLowerCase();
            const src = w.img || `https://loremflickr.com/200/200/${cleanKey},object?lock=${w.id}`;
            let textHtml = '';
            if(viewMode === 'all') textHtml = `<div class="item-label">${w.en}</div><div class="item-label-sub">${w.tr}</div>`;
            else if (viewMode === 'tr') textHtml = `<div class="item-label">${w.tr}</div>`;
            else if (viewMode === 'en') textHtml = `<div class="item-label">${w.en}</div>`;

            div.innerHTML = `<input type="checkbox" class="item-checkbox" ${isChecked} onclick="chkClick(event, 'word', ${w.id})"><img src="${src}" class="file-img">${textHtml}`;
            div.onclick = (e) => toggleSelect('word', w.id, e); div.ondblclick = () => openWordModal(w.id); div.oncontextmenu = (e) => showContextMenu(e, 'word', w.id);
            area.appendChild(div); count++;
        });

        document.getElementById('statusText').innerText = `${count} √∂ƒüe | ${selectedItems.size} se√ßili`;
        document.getElementById('topMenuPaste').style.display = clipboard.items.size > 0 ? 'flex' : 'none';
    }

    function updateAddressBar() {
        if (currentPath === null) { document.getElementById('addressPath').value = "Gezgin"; return; }
        let path = []; let curr = db.folders.find(f => f.id === currentPath);
        while(curr) { path.unshift(curr.name); curr = db.folders.find(f => f.id === curr.parentId); }
        document.getElementById('addressPath').value = "Gezgin / " + path.join(' / ');
    }
    
    function renderAll() { renderSidebar(); renderContent(); updateAddressBar(); updateNavButtons(); }

    // G√úNCELLENMƒ∞≈û MEN√ú FONKSƒ∞YONLARI
    function toggleMenu(id, e) { 
        e.stopPropagation(); 
        const menu = document.getElementById(id);
        const isActive = menu.classList.contains('active');
        
        closeAllMenus(); // √ñnce her ≈üeyi kapat
        
        if (!isActive) { // Eƒüer zaten aktif deƒüilse a√ß
            menu.classList.add('active'); 
            menu.querySelector('.drop-btn').classList.add('active'); 
        }
    }

    function closeAllMenus() { 
        document.querySelectorAll('.dropdown').forEach(d => { 
            d.classList.remove('active'); 
            d.querySelector('.drop-btn').classList.remove('active'); 
        }); 
        document.getElementById('contextMenu').style.display = 'none'; 
    }

    function showContextMenu(e, type, id) {
        e.preventDefault(); e.stopPropagation(); closeAllMenus(); ctxTarget = {type, id};
        if(id !== null && !selectedItems.has(`${type}-${id}`)) { selectedItems.clear(); selectedItems.add(`${type}-${id}`); renderContent(); }
        const menu = document.getElementById('contextMenu'); menu.style.display = 'block';
        let x = e.pageX; let y = e.pageY; if(x + 200 > window.innerWidth) x = window.innerWidth - 200; if(y + 300 > window.innerHeight) y = window.innerHeight - 300;
        menu.style.left = x + 'px'; menu.style.top = y + 'px';
        document.getElementById('ctxNewGroup').style.display = type === 'bg' ? 'block' : 'none';
        document.getElementById('ctxOpen').style.display = type === 'folder' ? 'flex' : 'none';
        document.getElementById('ctxCopy').style.display = type === 'bg' ? 'none' : 'flex';
        document.getElementById('ctxPaste').style.display = clipboard.items.size > 0 ? 'flex' : 'none';
        document.getElementById('ctxEdit').style.display = type === 'bg' ? 'none' : 'flex';
        document.getElementById('ctxDetails').style.display = type === 'bg' ? 'none' : 'flex';
        document.getElementById('ctxMove').style.display = type === 'bg' ? 'none' : 'flex';
        document.getElementById('ctxDelete').style.display = type === 'bg' ? 'none' : 'flex';
        document.getElementById('ctxDiv2').style.display = type === 'bg' ? 'none' : 'block';
        if(type === 'folder') document.getElementById('ctxEdit').innerHTML = "‚öôÔ∏è Yeniden Adlandƒ±r"; else document.getElementById('ctxEdit').innerHTML = "‚öôÔ∏è D√ºzenle";
    }

    function toggleUI() { 
        closeAllMenus();
        uiIsHidden = !uiIsHidden; 
        document.getElementById('sidebarTree').style.display = uiIsHidden ? 'none' : 'block'; 
        document.getElementById('uiStatusBar').style.display = uiIsHidden ? 'none' : 'flex'; 
    }

    function focusSearch() { 
        closeAllMenus();
        const searchBox = document.getElementById('uiSearchBox');
        const searchInput = document.getElementById('searchBox');
        
        if (window.getComputedStyle(searchBox).display === 'none') {
            searchBox.style.display = 'flex';
            searchInput.focus();
            searchInput.select();
        } else {
            searchBox.style.display = 'none';
            searchInput.value = '';
            renderContent();
        }
    }

    function showDetailsModal(type, id) {
        let title = "", dateStr = "", extraHtml = "";
        const formatDate = (ts) => { if(!ts || ts < 100000) return "Bilinmiyor"; return new Date(ts).toLocaleString('tr-TR'); };
        if(type === 'folder') {
            const f = db.folders.find(x => x.id === id); title = f.name; dateStr = formatDate(f.id);
            let stats = { folders: 0, words: 0, notes: 0 };
            function traverse(fId) { const subF = db.folders.filter(sub => sub.parentId === fId); stats.folders += subF.length; stats.words += db.words.filter(w => w.fid === fId).length; stats.notes += db.notes.filter(n => n.fid === fId).length; subF.forEach(sub => traverse(sub.id)); }
            traverse(id);
            extraHtml = `<div class="details-grid"><div class="details-label">ƒ∞√ßerik:</div><div>${stats.folders} Klas√∂r, ${stats.words} Kelime, ${stats.notes} Not</div></div>`;
        } else if(type === 'word') {
            const w = db.words.find(x => x.id === id); title = w.en + " (" + w.tr + ")"; dateStr = formatDate(w.id);
            extraHtml = `<div class="details-grid"><div class="details-label">T√ºr:</div><div>Kelime Kartƒ±</div></div>`;
        } else if(type === 'note') {
            const n = db.notes.find(x => x.id === id); title = n.title; dateStr = formatDate(n.id);
            extraHtml = `<div class="details-grid"><div class="details-label">T√ºr:</div><div>Geli≈ümi≈ü Not</div></div>`;
        }
        document.getElementById('detailsBody').innerHTML = `<div class="details-grid"><div class="details-label">Ad:</div><div><b>${title}</b></div></div><div class="details-grid"><div class="details-label">Olu≈üturulma:</div><div>${dateStr}</div></div>${extraHtml}`;
        document.getElementById('detailsDialog').style.display = 'flex';
    }

    function ctxAction(action) {
        closeAllMenus();
        if(action === 'open' && ctxTarget.type === 'folder') navigateTo(ctxTarget.id);
        if(action === 'copy') { clipboard.items = new Set(selectedItems); if(clipboard.items.size === 0 && ctxTarget && ctxTarget.id) clipboard.items.add(`${ctxTarget.type}-${ctxTarget.id}`); }
        if(action === 'paste') executePaste();
        if(action === 'edit') {
            if(ctxTarget.type === 'folder') { const f = db.folders.find(x => x.id === ctxTarget.id); const n = prompt("Yeni isim:", f.name); if(n && n.trim()) { f.name = n.trim(); saveDB(); } } 
            else if(ctxTarget.type === 'word') openWordModal(ctxTarget.id); else if(ctxTarget.type === 'note') openNoteModal(ctxTarget.id);
        }
        if(action === 'details') showDetailsModal(ctxTarget.type, ctxTarget.id);
        if(action === 'delete') deleteSelected();
        if(action === 'move') moveSelected();
    }

    function executePaste() {
        if(clipboard.items.size === 0) return;
        clipboard.items.forEach(key => {
            const parts = key.split('-'); const type = parts[0]; const id = parseInt(parts[1]);
            if(type === 'word') { const w = db.words.find(x => x.id === id); if(w) db.words.push({...w, id: Date.now() + Math.random(), fid: currentPath, en: w.en + " (Kopya)"}); }
            if(type === 'note') { const n = db.notes.find(x => x.id === id); if(n) db.notes.push({...n, id: Date.now() + Math.random(), fid: currentPath, title: n.title + " (Kopya)"}); }
            if(type === 'folder') copyFolderRecursive(id, currentPath);
        });
        saveDB();
    }

    function copyFolderRecursive(originalId, targetParentId) {
        const ogFolder = db.folders.find(f => f.id === originalId); if(!ogFolder) return;
        let curr = targetParentId ? db.folders.find(f => f.id === targetParentId) : null; while(curr) { if(curr.id === originalId) return; curr = db.folders.find(f => f.id === curr.parentId); }
        const newFolderId = Date.now() + Math.random(); db.folders.push({ id: newFolderId, name: ogFolder.name + (targetParentId === currentPath ? " (Kopya)" : ""), parentId: targetParentId });
        db.words.filter(w => w.fid === originalId).forEach(w => db.words.push({...w, id: Date.now() + Math.random(), fid: newFolderId})); db.notes.filter(n => n.fid === originalId).forEach(n => db.notes.push({...n, id: Date.now() + Math.random(), fid: newFolderId}));
        db.folders.filter(f => f.parentId === originalId).forEach(child => copyFolderRecursive(child.id, newFolderId));
    }

    function createItem(type) { 
        closeAllMenus();
        if(type === 'folder') { 
            let baseName = "Yeni Klas√∂r";
            let newName = baseName;
            let counter = 1;
            const existingFolders = db.folders.filter(f => f.parentId === currentPath).map(f => f.name);
            while(existingFolders.includes(newName)) { newName = `${baseName} ${counter}`; counter++; }
            const n = prompt("Klas√∂r Adƒ±:", newName); 
            if(n && n.trim()) { db.folders.push({id: Date.now(), name: n.trim(), parentId: currentPath}); saveDB(); } 
        } else if (type === 'word') { openWordModal(null); } else if (type === 'note') { openNoteModal(null); } 
    }
    
    function deleteSelected() {
        closeAllMenus();
        if(selectedItems.size === 0) return; if(!confirm(`${selectedItems.size} √∂ƒüeyi silmek istediƒüine emin misin?`)) return;
        selectedItems.forEach(key => {
            const parts = key.split('-'); const type = parts[0]; const id = parseInt(parts[1]);
            if(type === 'word') db.words = db.words.filter(w => w.id !== id); if(type === 'note') db.notes = db.notes.filter(n => n.id !== id);
            if(type === 'folder') { deleteFolderRecursiveInternal(id); if(currentPath === id) navigateTo(null, false); }
        });
        selectedItems.clear(); saveDB();
    }

    function deleteFolderRecursiveInternal(folderId) { db.folders.filter(f => f.parentId === folderId).forEach(c => deleteFolderRecursiveInternal(c.id)); db.words = db.words.filter(w => w.fid !== folderId); db.notes = db.notes.filter(n => n.fid !== folderId); db.folders = db.folders.filter(f => f.id !== folderId); }

    function moveSelected() {
        closeAllMenus();
        if(selectedItems.size === 0) { alert("Ta≈üƒ±mak i√ßin √∂ƒüe se√ß."); return; }
        document.getElementById('moveDialog').style.display = 'flex'; const select = document.getElementById('moveTargetSelect'); select.innerHTML = `<option value="root">Gezgin</option>`;
        function addOptions(parentId, prefix) { db.folders.filter(f => f.parentId === parentId).forEach(f => { if(selectedItems.has(`folder-${f.id}`)) return; select.innerHTML += `<option value="${f.id}">${prefix} ${f.name}</option>`; addOptions(f.id, prefix + "--"); }); }
        addOptions(null, "‚îî ");
    }

    function executeMove() {
        const tVal = document.getElementById('moveTargetSelect').value; if(!tVal) return; const tId = tVal === 'root' ? null : parseInt(tVal);
        selectedItems.forEach(key => {
            const parts = key.split('-'); const type = parts[0]; const id = parseInt(parts[1]);
            if(type === 'word') { const w = db.words.find(x => x.id === id); if(w) w.fid = tId; }
            if(type === 'note') { const n = db.notes.find(x => x.id === id); if(n) n.fid = tId; }
            if(type === 'folder') { let curr = tId ? db.folders.find(f => f.id === tId) : null; let conflict = false; while(curr) { if(curr.id === id) conflict = true; curr = db.folders.find(f => f.id === curr.parentId); } if(!conflict) { const f = db.folders.find(x => x.id === id); if(f) f.parentId = tId; } }
        });
        closeDialog('moveDialog'); selectedItems.clear(); saveDB();
    }

    async function startBulkImport() {
        const inputStr = document.getElementById('bulkInput').value; const lines = inputStr.split('\n').map(l => l.trim()).filter(l => l !== '');
        if(lines.length === 0) { alert("Kelime girmelisin."); return; }
        const langPair = document.getElementById('bulkLang').value; const btn = document.getElementById('bulkStartBtn'); const status = document.getElementById('bulkStatus'); btn.disabled = true;
        
        let sl = langPair === 'en|tr' ? 'en' : 'tr';
        let tl = langPair === 'en|tr' ? 'tr' : 'en';

        for(let i = 0; i < lines.length; i++) {
            const word = lines[i]; status.innerText = `ƒ∞≈üleniyor: ${i + 1} / ${lines.length} (${word})`;
            try {
                const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sl}&tl=${tl}&dt=t&q=${encodeURIComponent(word)}`); 
                const data = await res.json();
                let translated = data[0].map(item => item[0]).join(''); 
                
                let enVal, trVal;
                if(langPair === 'en|tr') { enVal = word; trVal = translated; } else { trVal = word; enVal = translated; }
                const cleanKey = enVal.split('/')[0].split(',')[0].trim().toLowerCase(); const uniqueId = Date.now() + i; const imgUrl = `https://loremflickr.com/400/300/${cleanKey},object?lock=${uniqueId}`;
                db.words.push({ id: uniqueId, en: enVal, tr: trVal, img: imgUrl, fid: currentPath });
            } catch(e) {}
        }
        status.innerText = "ƒ∞≈ülem Tamam!"; setTimeout(() => { closeDialog('bulkDialog'); saveDB(); btn.disabled = false; }, 1000);
    }

    function openBulkModal() {
        closeAllMenus();
        document.getElementById('bulkInput').value = '';
        document.getElementById('bulkStatus').innerText = '';
        document.getElementById('bulkDialog').style.display = 'flex';
    }

    function openWordModal(id) {
        document.getElementById('wordDialog').style.display = 'flex';
        if(id) {
            const w = db.words.find(x => x.id === id);
            document.getElementById('wId').value = w.id; document.getElementById('wEn').value = w.en; document.getElementById('wTr').value = w.tr; document.getElementById('wImg').value = w.img; updatePrev(w.img || `https://loremflickr.com/400/300/${w.en.split('/')[0].split(',')[0].trim().toLowerCase()},object?lock=${w.id}`); document.getElementById('wTitle').innerText = "√ñzellikler: " + w.en;
        } else { document.getElementById('wId').value = ''; document.getElementById('wEn').value = ''; document.getElementById('wTr').value = ''; document.getElementById('wImg').value = ''; document.getElementById('wPreview').src = ''; document.getElementById('wTitle').innerText = "Yeni Kelime Kartƒ±"; }
    }
    
    function saveWord() {
        const enVal = document.getElementById('wEn').value.trim(); if(!enVal) return; const id = document.getElementById('wId').value; let imgUrl = document.getElementById('wImg').value;
        if (!imgUrl) { const cleanKey = enVal.split('/')[0].split(',')[0].trim().toLowerCase(); const uniqueLockId = id ? id : Date.now(); imgUrl = `https://loremflickr.com/400/300/${cleanKey},object?lock=${uniqueLockId}`; }
        const data = { id: id ? parseInt(id) : Date.now(), en: enVal, tr: document.getElementById('wTr').value, img: imgUrl, fid: id ? db.words.find(w => w.id == id).fid : currentPath };
        if(id) { const idx = db.words.findIndex(x => x.id == id); db.words[idx] = data; } else { db.words.push(data); }
        closeDialog('wordDialog'); saveDB();
    }

    function openNoteModal(id) {
        document.getElementById('noteDialog').style.display = 'flex';
        if(id) { const n = db.notes.find(x => x.id === id); document.getElementById('nId').value = n.id; document.getElementById('nTitleInp').value = n.title; document.getElementById('nContent').innerHTML = n.content || ''; document.getElementById('nTitle').innerText = "Not: " + n.title;
        } else { document.getElementById('nId').value = ''; document.getElementById('nTitleInp').value = ''; document.getElementById('nContent').innerHTML = ''; document.getElementById('nTitle').innerText = "Yeni Not Defteri"; }
    }
    
    function saveNote() {
        const tVal = document.getElementById('nTitleInp').value.trim() || "Adsƒ±z Not"; const id = document.getElementById('nId').value; const cVal = document.getElementById('nContent').innerHTML;
        const data = { id: id ? parseInt(id) : Date.now(), title: tVal, content: cVal, fid: id ? db.notes.find(n => n.id == id).fid : currentPath };
        if(id) { const idx = db.notes.findIndex(x => x.id == id); db.notes[idx] = data; } else { db.notes.push(data); }
        closeDialog('noteDialog'); saveDB();
    }

    function closeDialog(id) { document.getElementById(id).style.display = 'none'; window.speechSynthesis.cancel(); }
    function updatePrev(url) { if(url) document.getElementById('wPreview').src = url; }
    function getClean() { return (document.getElementById('wEn').value || 'object').split('/')[0].split(',')[0].trim().toLowerCase(); }
    function autoFetchImage() { if(!document.getElementById('wImg').value) { const k = getClean(); if(k.length > 2) updatePrev(`https://loremflickr.com/400/300/${k},object`); } }
    function randomOSImage() { const u = `https://loremflickr.com/400/300/${getClean()}?random=${Math.random()}`; document.getElementById('wImg').value = u; updatePrev(u); }
    
    async function translateOS(from) {
        const eIn = document.getElementById('wEn'); const tIn = document.getElementById('wTr'); const ldr = document.getElementById('wLoader'); let txt = from === 'en' ? eIn.value : tIn.value; if(!txt) return; ldr.style.display = 'block';
        let sl = from === 'en' ? 'en' : 'tr'; let tl = from === 'en' ? 'tr' : 'en';
        try { 
            const res = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=${sl}&tl=${tl}&dt=t&q=${encodeURIComponent(txt)}`); 
            const data = await res.json();
            let translatedText = data[0].map(item => item[0]).join('');
            if(from === 'en') tIn.value = translatedText; else { eIn.value = translatedText; autoFetchImage(); }
        } catch(e) {} finally { ldr.style.display = 'none'; }
    }

    function exportData() { closeAllMenus(); const blob = new Blob([JSON.stringify(db)], {type: "text/json;charset=utf-8"}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `turing_backup.json`; a.click(); }
    function importData(e) { closeAllMenus(); const reader = new FileReader(); reader.onload = (ev) => { try { const imp = JSON.parse(ev.target.result); if(!imp.notes) imp.notes = []; db = imp; currentPath = null; historyStack=[null]; historyIndex=0; saveDB(); alert("Y√ºklendi."); } catch(err) { alert("Hata!"); } }; reader.readAsText(e.target.files[0]); }

    renderAll();
</script>
</body>
</html>
